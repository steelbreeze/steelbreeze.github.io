/**
 * state v5 finite state machine library
 * http://www.steelbreeze.net/state.cs
 * Copyright (c) 2014-5 Steelbreeze Limited
 * Licensed under the MIT and GPL v3 licences
 */
var __extends=this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])
i.prototype=e.prototype,t.prototype=new i},fsm
!function(t){function e(t){switch(t){case 0:case 2:case 1:return i
case 4:return n
case 3:return r
case 5:return o}}function i(t){if(1===t.length)return t[0]
throw"Initial transition must have a single outbound transition"}function n(t,e,i){var n,r,o=t.length
for(r=0;o>r;r++)if(t[r].guard(e,i)===!0){if(n)throw"Multiple outbound transitions evaluated true"
n=t[r]}if(!n)for(r=0;o>r;r++)if(t[r].guard===v.isElse){if(n)throw"Multiple outbound transitions evaluated true"
n=t[r]}return n}function r(t,e,i){var n,r,o=[],s=t.length
for(r=0;s>r;r++)t[r].guard(e,i)===!0&&o.push(t[r])
if(0!==o.length&&(n=o[Math.round((o.length-1)*Math.random())]),!n)for(r=0;s>r;r++)if(t[r].guard===v.isElse){if(n)throw"Multiple outbound transitions evaluated true"
n=t[r]}return n}function o(){}function s(t,e,i,n){for(var r=0,o=t.length;o>r;r++)t[r](e,i,n)}function a(t,e){if(!t)throw e}var h=function(){function t(t){this.name=t,this.leave=[],this.beginEnter=[],this.endEnter=[],this.enter=[]}return t.prototype.getParent=function(){},t.prototype.root=function(){return this.getParent().root()},t.prototype.ancestors=function(){return(this.getParent()?this.getParent().ancestors():[]).concat(this)},t.prototype.reset=function(){this.leave=[],this.beginEnter=[],this.endEnter=[],this.enter=[]},t.prototype.bootstrap=function(){this.enter=this.beginEnter.concat(this.endEnter)},t.prototype.bootstrapEnter=function(t){t(this.beginEnter)},t.prototype.toString=function(){return this.ancestors().map(function(t){return t.name}).join(t.namespaceSeparator)},t.namespaceSeparator=".",t}()
t.Element=h
var u=function(t){function e(e,i){t.call(this,e),this.parent=i,this.vertices=[],i.regions.push(this),i.root().clean=!1}return __extends(e,t),e.prototype.getParent=function(){return this.parent},e.prototype.isComplete=function(t){return t.getCurrent(this).isFinal()},e.prototype.bootstrap=function(e){for(var i=this,n=0,r=this.vertices.length;r>n;n++)this.vertices[n].reset(),this.vertices[n].bootstrap(e||this.initial&&2===this.initial.kind)
this.leave.push(function(t,e,n){var r=e.getCurrent(i)
r.leave&&s(r.leave,t,e,n)}),e||!this.initial||this.initial.isHistory()?this.endEnter.push(function(t,e,n){var r=i.initial;(n||i.initial.isHistory())&&(r=e.getCurrent(i)||i.initial),s(r.enter,t,e,n||2===i.initial.kind)}):this.endEnter=this.endEnter.concat(this.initial.enter),t.prototype.bootstrap.call(this,e)},e.prototype.bootstrapTransitions=function(){for(var t=0,e=this.vertices.length;e>t;t++)this.vertices[t].bootstrapTransitions()},e.prototype.evaluate=function(t,e){return e.getCurrent(this).evaluate(t,e)},e.defaultName="default",e}(h)
t.Region=u
var c=function(t){function e(e,i,n){t.call(this,e),this.transitions=[],this.selector=n,i instanceof u?this.region=i:i instanceof l&&(this.region=i.defaultRegion()),this.region&&(this.region.vertices.push(this),this.region.root().clean=!1)}return __extends(e,t),e.prototype.getParent=function(){return this.region},e.prototype.isComplete=function(){return!0},e.prototype.to=function(t){var e=new v(this,t)
return this.transitions.push(e),this.root().clean=!1,e},e.prototype.bootstrap=function(e){var i=this
t.prototype.bootstrap.call(this,e),this.endEnter.push(function(t,e,n){i.evaluateCompletions(t,e,n)}),this.enter=this.beginEnter.concat(this.endEnter)},e.prototype.bootstrapTransitions=function(){for(var t=0,e=this.transitions.length;e>t;t++)this.transitions[t].bootstrap()},e.prototype.evaluateCompletions=function(t,e){this.isComplete(e)&&this.evaluate(this,e)},e.prototype.evaluate=function(t,e){var i=this.selector(this.transitions,t,e)
return i?(s(i.traverse,t,e,!1),!0):!1},e}(h)
t.Vertex=c,function(t){t[t.Initial=0]="Initial",t[t.ShallowHistory=1]="ShallowHistory",t[t.DeepHistory=2]="DeepHistory",t[t.Choice=3]="Choice",t[t.Junction=4]="Junction",t[t.Terminate=5]="Terminate"}(t.PseudoStateKind||(t.PseudoStateKind={}))
var p=(t.PseudoStateKind,function(t){function i(i,n,r){t.call(this,i,n,e(r)),this.kind=r,this.isInitial()&&(this.region.initial=this)}return __extends(i,t),i.prototype.isHistory=function(){return 2===this.kind||1===this.kind},i.prototype.isInitial=function(){return 0===this.kind||this.isHistory()},i.prototype.bootstrap=function(e){t.prototype.bootstrap.call(this,e),5===this.kind&&this.enter.push(function(t,e){e.isTerminated=!0})},i}(c))
t.PseudoState=p
var l=function(t){function e(i,n){t.call(this,i,n,e.selector),this.exitBehavior=[],this.entryBehavior=[],this.regions=[]}return __extends(e,t),e.selector=function(t,e,i){for(var n,r=0,o=t.length;o>r;r++)if(t[r].guard(e,i)){if(n)throw"Multiple outbound transitions evaluated true"
n=t[r]}return n},e.prototype.defaultRegion=function(){for(var t,e=0,i=this.regions.length;i>e;e++)this.regions[e].name===u.defaultName&&(t=this.regions[e])
return t||(t=new u(u.defaultName,this)),t},e.prototype.isFinal=function(){return 0===this.transitions.length},e.prototype.isSimple=function(){return 0===this.regions.length},e.prototype.isComposite=function(){return this.regions.length>0},e.prototype.isOrthogonal=function(){return this.regions.length>1},e.prototype.exit=function(t){return this.exitBehavior.push(t),this.root().clean=!1,this},e.prototype.entry=function(t){return this.entryBehavior.push(t),this.root().clean=!1,this},e.prototype.bootstrap=function(e){for(var i=this,n=0,r=this.regions.length;r>n;n++){var o=this.regions[n]
o.reset(),o.bootstrap(e),this.leave.push(function(t,e,i){s(o.leave,t,e,i)}),this.endEnter=this.endEnter.concat(o.enter)}t.prototype.bootstrap.call(this,e),this.leave=this.leave.concat(this.exitBehavior),this.beginEnter=this.beginEnter.concat(this.entryBehavior),this.beginEnter.push(function(t,e){i.region&&e.setCurrent(i.region,i)}),this.enter=this.beginEnter.concat(this.endEnter)},e.prototype.bootstrapTransitions=function(){for(var e=0,i=this.regions.length;i>e;e++)this.regions[e].bootstrapTransitions()
t.prototype.bootstrapTransitions.call(this)},e.prototype.bootstrapEnter=function(e,i){t.prototype.bootstrapEnter.call(this,e,i)
for(var n=0,r=this.regions.length;r>n;n++)this.regions[n]!==i&&e(this.regions[n].enter)},e.prototype.evaluate=function(e,i){for(var n=!1,r=0,o=this.regions.length;o>r;r++)this.regions[r].evaluate(e,i)&&(n=!0)
return n===!1&&(n=t.prototype.evaluate.call(this,e,i)),n===!0&&e!==this&&this.evaluateCompletions(this,i,!1),n},e}(c)
t.State=l
var f=function(t){function e(e,i){t.call(this,e,i)}return __extends(e,t),e.prototype.to=function(){throw"A FinalState cannot be the source of a transition."},e}(l)
t.FinalState=f
var g=function(t){function e(e){t.call(this,e,void 0),this.clean=!0}return __extends(e,t),e.prototype.root=function(){return this},e.prototype.bootstrap=function(e){t.prototype.reset.call(this),this.clean=!0,t.prototype.bootstrap.call(this,e),t.prototype.bootstrapTransitions.call(this)},e.prototype.initialise=function(t,e){void 0===e&&(e=!0),e&&this.clean===!1&&this.bootstrap(!1),s(this.enter,void 0,t,!1)},e.prototype.evaluate=function(e,i,n){return void 0===n&&(n=!0),n&&this.clean===!1&&this.bootstrap(!1),i.isTerminated?!1:t.prototype.evaluate.call(this,e,i)},e}(l)
t.StateMachine=g
var v=function(){function t(t,e){var i=this
this.source=t,this.target=e,this.transitionBehavior=[],this.traverse=[],this.guard=function(t){return t===i.source}}return t.prototype["else"]=function(){return this.guard=t.isElse,this},t.prototype.when=function(t){return this.guard=t,this},t.prototype.effect=function(t){return this.transitionBehavior.push(t),this.source.root().clean=!1,this},t.prototype.bootstrap=function(){var t=this
if(null===this.target)this.traverse=this.transitionBehavior
else if(this.target.getParent()===this.source.getParent())this.traverse=this.source.leave.concat(this.transitionBehavior).concat(this.target.enter)
else{for(var e=this.source.ancestors(),i=this.target.ancestors(),n=e.length,r=i.length,o=0,s=Math.min(n,r);s>o&&e[o]===i[o];)o++
for(a(!(e[o]instanceof u),"Transitions may not cross sibling orthogonal region boundaries"),this.traverse=(n>o?e[o]:this.source).leave.slice(0),this.traverse=this.traverse.concat(this.transitionBehavior),o>=r&&(this.traverse=this.traverse.concat(this.target.beginEnter));r>o;)i[o++].bootstrapEnter(function(e){t.traverse=t.traverse.concat(e)},i[o])
this.traverse=this.traverse.concat(this.target.endEnter)}},t.isElse=function(){return!1},t}()
t.Transition=v
var y=function(){function t(){this.isTerminated=!1,this.last={}}return t.prototype.setCurrent=function(t,e){this.last[t.toString()]=e},t.prototype.getCurrent=function(t){return this.last[t.toString()]},t}()
t.Context=y}(fsm||(fsm={}))

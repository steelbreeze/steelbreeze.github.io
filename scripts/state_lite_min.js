(function(d){function i(l,k){if(l.active){return l.active[k]}}function f(l,k){if(l.current){return l.current[k]}}function j(l){var k=l.owner?j(l.owner):[];k.push(l);return k}function e(m,n,k){this.guard=k||function(){return true};if(n&&(n!==null)){var p=j(m.owner),o=j(n.owner),l=0;while(p.length>l&&o.length>l&&p[l]===o[l]){l=l+1}this.sourceAncestorsToExit=p.slice(l).reverse();this.targetAncestorsToEnter=o.slice(l);this.source=m;this.target=n}m[k&&k.length>0?"transitions":"completions"].push(this)}e.prototype.traverse=function(m,n){var l,k;if(this.source){this.source.beginExit(m);this.source.endExit(m);for(l=0,k=this.sourceAncestorsToExit.length;l<k;l=l+1){this.sourceAncestorsToExit[l].endExit(m)}}if(this.effect){for(l=0,k=this.effect.length;l<k;l=l+1){this.effect[l](n)}}if(this.target){for(l=0,k=this.targetAncestorsToEnter.length;l<k;l=l+1){this.targetAncestorsToEnter[l].beginEnter(m)}this.target.beginEnter(m);this.target.endEnter(m,false)}};e.Else=function(k,l){e.call(this,k,l,function(){return false})};e.Else.prototype=e.prototype;e.Else.prototype.constructor=e.Else;function h(o,m){var n,l,k;for(n=0,l=o.length;n<l;n=n+1){if(m(o[n])){if(k){throw"single found more than one result"}k=o[n]}}return k}var c={DeepHistory:{isInitial:true,isHistory:true,completions:function(k){return k[0]}},Initial:{isInitial:true,isHistory:false,completions:function(k){return k[0]}},Junction:{isInitial:false,isHistory:false,completions:function(k){return h(k,function(l){return l.guard()})||h(k,function(l){return l instanceof e.Else})}},ShallowHistory:{isInitial:true,isHistory:true,completions:function(k){return k[0]}},Terminate:{isInitial:false,isHistory:false,completions:null}};function a(l,k){this.name=l;this.owner=k;if(this.owner){this.owner.isComposite=true}}a.prototype.beginExit=function(k){};a.prototype.endExit=function(k){k.active[this]=false};a.prototype.beginEnter=function(k){if(i(k,this)){this.beginExit(k);this.endExit(k)}if(!k.active){k.active=[]}k.active[this]=true};a.prototype.endEnter=function(l,k){};a.prototype.toString=function(){return this.owner?this.owner+"."+this.name:this.name};function b(l,m,k){a.call(this,l,k);this.kind=m;this.completions=[];if(this.kind.isInitial){this.owner.initial=this}}b.prototype=new a();b.prototype.constructor=b;b.prototype.endEnter=function(l,k){if(this.kind===c.Terminate){l.IsTerminated=true}else{this.kind.completions(this.completions).traverse(l,k)}};function g(l,k){a.call(this,l,k);this.completions=[];this.transitions=[];this.isComposite=false}g.prototype=new a();g.prototype.constructor=g;g.prototype.isComplete=function(k){if(this.isComposite===false){return true}var l=f(k,this);return k.isTerminated||l===null||(l.transitions.length===0&&l.completions.length===0)||i(k,l)===false};g.prototype.initialise=function(k){this.beginEnter(k);this.endEnter(k,false)};g.prototype.beginExit=function(k){var l=f(k,this);if(l){l.beginExit(k);l.endExit(k)}};g.prototype.endExit=function(m){if(this.exit){var l,k;for(l=0,k=this.exit.length;l<k;l=l+1){this.exit[l]()}}a.prototype.endExit.call(this,m)};g.prototype.beginEnter=function(m){a.prototype.beginEnter.call(this,m);if(this.owner){if(!m.current){m.current=[]}m.current[this.owner]=this}if(this.entry){var l,k;for(l=0,k=this.entry.length;l<k;l=l+1){this.entry[l]()}}};g.prototype.endEnter=function(m,l){var n,k;if(this.isComposite){n=(l||this.initial.kind.isHistory?f(m,this):this.initial)||this.initial;n.beginEnter(m);n.endEnter(m,l||this.initial.kind===c.DeepHistory)}if(this.isComplete(m)){k=h(this.completions,function(o){return o.guard()});if(k){k.traverse(m,l)}}};g.prototype.process=function(l,m){var k=h(this.transitions,function(n){return n.guard(m)});if(k){k.traverse(l,m);return true}return this.isComposite&&f(l,this).process(l,m)};d.PseudoStateKind=c;d.PseudoState=b;d.State=g;d.Transition=e}(this.exports||this));
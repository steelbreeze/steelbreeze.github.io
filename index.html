<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>Application portfolio</title>
	<style>
		body {
			font-family: Arial, Helvetica, sans-serif;
			color: #27394F;
			max-width: 1200px;
			margin: 0 auto;
			padding: 1em;
		}

		h1,
		h2 {
			margin: 0;
		}

		h3 {
			margin-bottom: 0;
		}

		p {
			margin: 0.25em 0 0.75em 0;
		}

		table.heatmap {
			width: 100%;

			margin: 1em 0;
/*
			border: 2px solid #D0D5DA;
			border-radius: 1em;
*/
			border-collapse: separate;
			border-spacing: 0;
/*
			padding: 0.9em;
*/
			font-family: Tahoma, sans-serif;
			font-size: 0.8em;
			color: rgb(242, 243, 242);

			table-layout: fixed;
		}

		table.heatmap th {
			border: 1px solid white;
			padding: 0.25em 0.75em;
			font-weight: normal;
		}

		table.heatmap td {
			border: 1px solid white;
			padding: 0.75em;
			font-weight: normal;
			text-align: center;
		}


		table.heatmap th.tableHeading {
			color: #D0D5DA;
		}

		table.heatmap th.axisX {
			background: #7FD3F7;
			padding: 0.25em 0.75em;
		}

		table.heatmap td.axisY {
			background: #00A7F0;
		}

		table.heatmap .green {
			background: #18c73e;
		}

		table.heatmap .amber {
			background: orange;
		}

		table.heatmap .red {
			background: red;
		}

		table.heatmap td.application:empty {
			background: repeating-linear-gradient(135deg, white, white 4px, #D0D5DA 4px, #D0D5DA 6px);
		}
	</style>

</head>

<body>
	<header>
		<h2>Steelbreeze</h2>
	</header>
	<h1>Application portfolio heat-maps</h1>
	<table class="heatmap" id="lineOfBusiness">
		<thead></thead>
		<tbody></tbody>
	</table>
	<p>The heat-map above is auto-generated from a <a href="./demoData.json">JSON file</a> containing information about
		applications and the context in which they are used. The values on the x and y axis are extracted from the data
		and an optimal layout is calculated to maximise adjancent cells having the same content. The table is then rendered with adjacent cells with the same content merged.</p>
	<h3>Outstanding work</h3>
	<p>Only test applications where there are more than one instance of the application/status combination.</p>
	<p>Split cells where there is more than one application. Note: at the moment, the cell colour is taken from the first application.</p>
	<p>Where there are multiple scenarios with the same number of adjacent cells, allow the user to provide hints to select a preferred option.</p>
	<p>Refactor the D3 code to layout the HTML table.</p>
</body>

<script src="./dist/d3.min.js"></script>
<script src="./dist/layout.min.js"></script>
<script>
	const applications = layout.getDemoData();
	const scenarios = layout.optimise(applications, "product", "capability", layout.bruteForce);
	const scenario = scenarios[0]; // TODO: find the most favorable scenario based on preferences

	const table = layout.prepare(applications, scenario); // NOTE: you do not have to use a generated scenario, you can hard-code one

	var header = d3.select("#lineOfBusiness").select("thead").append("tr");

	header.selectAll("th").data(["", ...scenario.xAxis.values]) // TODO: remove when axis returned by prepare
		.enter()
		.append("th")
		.classed('axisX', (d, i) => i !== 0)
		.classed('tableHeading', (d, i) => i === 0)
		.text(d => d);

	var body = d3.select("#lineOfBusiness").select("tbody");

	body.selectAll("tr").data(scenario.yAxis.values)
		.enter()
		.append("tr").data(table)
		.selectAll("td")
		.data((row, rowIndex) => [[{ name: scenario.yAxis.values[rowIndex], "status": "axisY" }], ...row]) // TODO: remove when axis returned by prepare
		.enter()
		.append("td")
		.attr("class", d => d.length === 0 ? "application" : `application ${d[0].status}`)
		.attr("colspan", d => d.length === 1 ? d[0].colspan : 1)
		.attr("rowspan", d => d.length === 1 ? d[0].rowspan : 1)
		.text(d => d.map(a => a.name).join(", "));
</script>

</html>